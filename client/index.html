<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <title>focusWalker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://a.basemaps.cartocdn.com" crossorigin />
    <link rel="preconnect" href="https://b.basemaps.cartocdn.com" crossorigin />
    <link rel="preconnect" href="https://c.basemaps.cartocdn.com" crossorigin />

    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Playpen+Sans+Thai:wght@800&display=swap"
    />
    <link rel="modulepreload" href="/src/main.tsx" />
    <link
      rel="stylesheet"
      href="leaflet.css"
      media="print"
      onload="this.media='all'"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Playpen+Sans+Thai:wght@800&display=swap"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin
      media="print"
      onload="this.media='all'"
    />

    <link rel="manifest" href="/manifest.json" />

    <style>
      :root {
        --bg: #ffffff;
        --text: #0f172a;
        --neon: #bfff04;
        --ui-card: rgba(15, 23, 42, 0.05);
        --hud-border: rgba(0, 0, 0, 0.05);
      }

      :root.dark {
        --bg: #050505;
        --text: #ffffff;
        --neon: #bfff04;
        --ui-card: rgba(255, 255, 255, 0.03);
        --hud-border: rgba(255, 255, 255, 0.05);
      }

      /* Base Styles */
      body,
      html {
        margin: 0;
        padding: 0;
        background: var(--bg);
        height: 100%;
        width: 100%;
        overflow: hidden;
        font-family: "Playpen Sans Thai", system-ui, sans-serif;
      }

      /* 2. THE TACTICAL GRID: Renders in ~10ms */
      #loading-overlay {
        position: fixed;
        inset: 0;
        background: var(--bg);
        background-image: linear-gradient(
            var(--hud-border) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, var(--hud-border) 1px, transparent 1px);
        background-size: 40px 40px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .splash-logo {
        position: relative;
        z-index: 10;
      }
      .logo-text {
        color: var(--text);
        font-size: clamp(24px, 8vw, 36px);
        font-weight: 900;
        letter-spacing: -0.05em;
        text-transform: uppercase;
        font-style: italic;
      }

      .logo-text::after {
        content: "";
        display: block;
        width: 60%;
        height: 4px;
        background: var(--neon);
        margin: 4px auto 0;
        box-shadow: 0 0 20px var(--neon);
      }

      /* SKELETON SHELL */
      #shell {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: calc(env(safe-area-inset-top) + 20px) 20px
          calc(env(safe-area-inset-bottom) + 30px);
        pointer-events: none;
      }

      .skeleton {
        background: var(--ui-card);
        backdrop-filter: blur(10px);
        border: 1px solid var(--hud-border);
        animation: pulse 1.5s ease-in-out infinite;
      }

      .top-hud-skeleton {
        width: 140px;
        height: 48px;
        border-radius: 16px;
      }
      .bottom-card-skeleton {
        width: 100%;
        height: 160px;
        border-radius: 24px;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.4;
        }
        50% {
          opacity: 0.8;
        }
      }

      .scanner {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--neon);
        box-shadow: 0 0 15px var(--neon);
        opacity: 0.3;
        animation: scan 4s linear infinite;
        will-change: transform; /* Important: Tells browser to use GPU */
      }

      @keyframes scan {
        0% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(100vh);
        }
      }
    </style>
  </head>
  <body>
    <script>
      (function () {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        document.documentElement.classList.add(theme);
      })();
    </script>

    <div id="loading-overlay">
      <div class="scanner"></div>
      <div class="splash-logo">
        <div class="logo-text">focusWalker</div>
      </div>
      <div id="shell">
        <div class="top-hud-skeleton skeleton"></div>
        <div class="bottom-card-skeleton skeleton"></div>
      </div>
    </div>

    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      window.addEventListener("load", () => {
        const overlay = document.getElementById("loading-overlay");
        if (overlay) {
          overlay.style.opacity = "0";
          setTimeout(() => overlay.remove(), 1500);
        }
      });
    </script>
  </body>
</html>
